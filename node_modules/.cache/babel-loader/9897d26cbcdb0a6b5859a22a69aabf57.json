{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parseFeed = exports.FeedHandler = void 0;\n\nvar domhandler_1 = __importDefault(require(\"domhandler\"));\n\nvar DomUtils = __importStar(require(\"domutils\"));\n\nvar Parser_1 = require(\"./Parser\");\n\nvar FeedItemMediaMedium;\n\n(function (FeedItemMediaMedium) {\n  FeedItemMediaMedium[FeedItemMediaMedium[\"image\"] = 0] = \"image\";\n  FeedItemMediaMedium[FeedItemMediaMedium[\"audio\"] = 1] = \"audio\";\n  FeedItemMediaMedium[FeedItemMediaMedium[\"video\"] = 2] = \"video\";\n  FeedItemMediaMedium[FeedItemMediaMedium[\"document\"] = 3] = \"document\";\n  FeedItemMediaMedium[FeedItemMediaMedium[\"executable\"] = 4] = \"executable\";\n})(FeedItemMediaMedium || (FeedItemMediaMedium = {}));\n\nvar FeedItemMediaExpression;\n\n(function (FeedItemMediaExpression) {\n  FeedItemMediaExpression[FeedItemMediaExpression[\"sample\"] = 0] = \"sample\";\n  FeedItemMediaExpression[FeedItemMediaExpression[\"full\"] = 1] = \"full\";\n  FeedItemMediaExpression[FeedItemMediaExpression[\"nonstop\"] = 2] = \"nonstop\";\n})(FeedItemMediaExpression || (FeedItemMediaExpression = {})); // TODO: Consume data as it is coming in\n\n\nvar FeedHandler = function (_super) {\n  __extends(FeedHandler, _super);\n  /**\n   *\n   * @param callback\n   * @param options\n   */\n\n\n  function FeedHandler(callback, options) {\n    var _this = this;\n\n    if (typeof callback === \"object\") {\n      callback = undefined;\n      options = callback;\n    }\n\n    _this = _super.call(this, callback, options) || this;\n    return _this;\n  }\n\n  FeedHandler.prototype.onend = function () {\n    var _a, _b;\n\n    var feed = {};\n    var feedRoot = getOneElement(isValidFeed, this.dom);\n\n    if (feedRoot) {\n      if (feedRoot.name === \"feed\") {\n        var childs = feedRoot.children;\n        feed.type = \"atom\";\n        addConditionally(feed, \"id\", \"id\", childs);\n        addConditionally(feed, \"title\", \"title\", childs);\n        var href = getAttribute(\"href\", getOneElement(\"link\", childs));\n\n        if (href) {\n          feed.link = href;\n        }\n\n        addConditionally(feed, \"description\", \"subtitle\", childs);\n        var updated = fetch(\"updated\", childs);\n\n        if (updated) {\n          feed.updated = new Date(updated);\n        }\n\n        addConditionally(feed, \"author\", \"email\", childs, true);\n        feed.items = getElements(\"entry\", childs).map(function (item) {\n          var entry = {};\n          var children = item.children;\n          addConditionally(entry, \"id\", \"id\", children);\n          addConditionally(entry, \"title\", \"title\", children);\n          var href = getAttribute(\"href\", getOneElement(\"link\", children));\n\n          if (href) {\n            entry.link = href;\n          }\n\n          var description = fetch(\"summary\", children) || fetch(\"content\", children);\n\n          if (description) {\n            entry.description = description;\n          }\n\n          var pubDate = fetch(\"updated\", children);\n\n          if (pubDate) {\n            entry.pubDate = new Date(pubDate);\n          }\n\n          entry.media = getMediaElements(children);\n          return entry;\n        });\n      } else {\n        var childs = (_b = (_a = getOneElement(\"channel\", feedRoot.children)) === null || _a === void 0 ? void 0 : _a.children) !== null && _b !== void 0 ? _b : [];\n        feed.type = feedRoot.name.substr(0, 3);\n        feed.id = \"\";\n        addConditionally(feed, \"title\", \"title\", childs);\n        addConditionally(feed, \"link\", \"link\", childs);\n        addConditionally(feed, \"description\", \"description\", childs);\n        var updated = fetch(\"lastBuildDate\", childs);\n\n        if (updated) {\n          feed.updated = new Date(updated);\n        }\n\n        addConditionally(feed, \"author\", \"managingEditor\", childs, true);\n        feed.items = getElements(\"item\", feedRoot.children).map(function (item) {\n          var entry = {};\n          var children = item.children;\n          addConditionally(entry, \"id\", \"guid\", children);\n          addConditionally(entry, \"title\", \"title\", children);\n          addConditionally(entry, \"link\", \"link\", children);\n          addConditionally(entry, \"description\", \"description\", children);\n          var pubDate = fetch(\"pubDate\", children);\n          if (pubDate) entry.pubDate = new Date(pubDate);\n          entry.media = getMediaElements(children);\n          return entry;\n        });\n      }\n    }\n\n    this.feed = feed;\n    this.handleCallback(feedRoot ? null : Error(\"couldn't find root of feed\"));\n  };\n\n  return FeedHandler;\n}(domhandler_1.default);\n\nexports.FeedHandler = FeedHandler;\n\nfunction getMediaElements(where) {\n  return getElements(\"media:content\", where).map(function (elem) {\n    var media = {\n      medium: elem.attribs.medium,\n      isDefault: !!elem.attribs.isDefault\n    };\n\n    if (elem.attribs.url) {\n      media.url = elem.attribs.url;\n    }\n\n    if (elem.attribs.fileSize) {\n      media.fileSize = parseInt(elem.attribs.fileSize, 10);\n    }\n\n    if (elem.attribs.type) {\n      media.type = elem.attribs.type;\n    }\n\n    if (elem.attribs.expression) {\n      media.expression = elem.attribs.expression;\n    }\n\n    if (elem.attribs.bitrate) {\n      media.bitrate = parseInt(elem.attribs.bitrate, 10);\n    }\n\n    if (elem.attribs.framerate) {\n      media.framerate = parseInt(elem.attribs.framerate, 10);\n    }\n\n    if (elem.attribs.samplingrate) {\n      media.samplingrate = parseInt(elem.attribs.samplingrate, 10);\n    }\n\n    if (elem.attribs.channels) {\n      media.channels = parseInt(elem.attribs.channels, 10);\n    }\n\n    if (elem.attribs.duration) {\n      media.duration = parseInt(elem.attribs.duration, 10);\n    }\n\n    if (elem.attribs.height) {\n      media.height = parseInt(elem.attribs.height, 10);\n    }\n\n    if (elem.attribs.width) {\n      media.width = parseInt(elem.attribs.width, 10);\n    }\n\n    if (elem.attribs.lang) {\n      media.lang = elem.attribs.lang;\n    }\n\n    return media;\n  });\n}\n\nfunction getElements(tagName, where) {\n  return DomUtils.getElementsByTagName(tagName, where, true);\n}\n\nfunction getOneElement(tagName, node) {\n  return DomUtils.getElementsByTagName(tagName, node, true, 1)[0];\n}\n\nfunction fetch(tagName, where, recurse) {\n  if (recurse === void 0) {\n    recurse = false;\n  }\n\n  return DomUtils.getText(DomUtils.getElementsByTagName(tagName, where, recurse, 1)).trim();\n}\n\nfunction getAttribute(name, elem) {\n  if (!elem) {\n    return null;\n  }\n\n  var attribs = elem.attribs;\n  return attribs[name];\n}\n\nfunction addConditionally(obj, prop, what, where, recurse) {\n  if (recurse === void 0) {\n    recurse = false;\n  }\n\n  var tmp = fetch(what, where, recurse);\n  if (tmp) obj[prop] = tmp;\n}\n\nfunction isValidFeed(value) {\n  return value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n}\n\nvar defaultOptions = {\n  xmlMode: true\n};\n/**\n * Parse a feed.\n *\n * @param feed The feed that should be parsed, as a string.\n * @param options Optionally, options for parsing. When using this option, you probably want to set `xmlMode` to `true`.\n */\n\nfunction parseFeed(feed, options) {\n  if (options === void 0) {\n    options = defaultOptions;\n  }\n\n  var handler = new FeedHandler(options);\n  new Parser_1.Parser(handler, options).end(feed);\n  return handler.feed;\n}\n\nexports.parseFeed = parseFeed;","map":{"version":3,"sources":["/Users/mark/localRepos/StarBrightlyShining/node_modules/microdata-rdf-streaming-parser/node_modules/htmlparser2/lib/FeedHandler.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","__createBinding","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","__importDefault","exports","parseFeed","FeedHandler","domhandler_1","require","DomUtils","Parser_1","FeedItemMediaMedium","FeedItemMediaExpression","_super","callback","options","_this","onend","_a","_b","feed","feedRoot","getOneElement","isValidFeed","dom","name","childs","children","type","addConditionally","href","getAttribute","link","updated","fetch","Date","items","getElements","map","item","entry","description","pubDate","media","getMediaElements","substr","id","handleCallback","Error","default","where","elem","medium","attribs","isDefault","url","fileSize","parseInt","expression","bitrate","framerate","samplingrate","channels","duration","height","width","lang","tagName","getElementsByTagName","node","recurse","getText","trim","obj","prop","what","tmp","defaultOptions","xmlMode","handler","Parser","end"],"mappings":"AAAA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIC,MAAM,CAACK,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EAAgDN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAFrG;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASS,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBX,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACO,SAAF,GAAcN,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACU,MAAP,CAAcX,CAAd,CAAb,IAAiCS,EAAE,CAACH,SAAH,GAAeN,CAAC,CAACM,SAAjB,EAA4B,IAAIG,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaA,IAAIG,eAAe,GAAI,QAAQ,KAAKA,eAAd,KAAmCX,MAAM,CAACU,MAAP,GAAiB,UAASE,CAAT,EAAYC,CAAZ,EAAeC,CAAf,EAAkBC,EAAlB,EAAsB;AAC5F,MAAIA,EAAE,KAAKC,SAAX,EAAsBD,EAAE,GAAGD,CAAL;AACtBd,EAAAA,MAAM,CAACiB,cAAP,CAAsBL,CAAtB,EAAyBG,EAAzB,EAA6B;AAAEG,IAAAA,UAAU,EAAE,IAAd;AAAoBC,IAAAA,GAAG,EAAE,YAAW;AAAE,aAAON,CAAC,CAACC,CAAD,CAAR;AAAc;AAApD,GAA7B;AACH,CAHwD,GAGnD,UAASF,CAAT,EAAYC,CAAZ,EAAeC,CAAf,EAAkBC,EAAlB,EAAsB;AACxB,MAAIA,EAAE,KAAKC,SAAX,EAAsBD,EAAE,GAAGD,CAAL;AACtBF,EAAAA,CAAC,CAACG,EAAD,CAAD,GAAQF,CAAC,CAACC,CAAD,CAAT;AACH,CANqB,CAAtB;;AAOA,IAAIM,kBAAkB,GAAI,QAAQ,KAAKA,kBAAd,KAAsCpB,MAAM,CAACU,MAAP,GAAiB,UAASE,CAAT,EAAYS,CAAZ,EAAe;AAC3FrB,EAAAA,MAAM,CAACiB,cAAP,CAAsBL,CAAtB,EAAyB,SAAzB,EAAoC;AAAEM,IAAAA,UAAU,EAAE,IAAd;AAAoBI,IAAAA,KAAK,EAAED;AAA3B,GAApC;AACH,CAF8D,GAE1D,UAAST,CAAT,EAAYS,CAAZ,EAAe;AAChBT,EAAAA,CAAC,CAAC,SAAD,CAAD,GAAeS,CAAf;AACH,CAJwB,CAAzB;;AAKA,IAAIE,YAAY,GAAI,QAAQ,KAAKA,YAAd,IAA+B,UAAUC,GAAV,EAAe;AAC7D,MAAIA,GAAG,IAAIA,GAAG,CAACC,UAAf,EAA2B,OAAOD,GAAP;AAC3B,MAAIE,MAAM,GAAG,EAAb;AACA,MAAIF,GAAG,IAAI,IAAX,EAAiB,KAAK,IAAIV,CAAT,IAAcU,GAAd,EAAmB,IAAIV,CAAC,KAAK,SAAN,IAAmBd,MAAM,CAACK,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCiB,GAArC,EAA0CV,CAA1C,CAAvB,EAAqEH,eAAe,CAACe,MAAD,EAASF,GAAT,EAAcV,CAAd,CAAf;;AACzGM,EAAAA,kBAAkB,CAACM,MAAD,EAASF,GAAT,CAAlB;;AACA,SAAOE,MAAP;AACH,CAND;;AAOA,IAAIC,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUH,GAAV,EAAe;AACnE,SAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;AAAE,eAAWA;AAAb,GAAvC;AACH,CAFD;;AAGAxB,MAAM,CAACiB,cAAP,CAAsBW,OAAtB,EAA+B,YAA/B,EAA6C;AAAEN,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAM,OAAO,CAACC,SAAR,GAAoBD,OAAO,CAACE,WAAR,GAAsB,KAAK,CAA/C;;AACA,IAAIC,YAAY,GAAGJ,eAAe,CAACK,OAAO,CAAC,YAAD,CAAR,CAAlC;;AACA,IAAIC,QAAQ,GAAGV,YAAY,CAACS,OAAO,CAAC,UAAD,CAAR,CAA3B;;AACA,IAAIE,QAAQ,GAAGF,OAAO,CAAC,UAAD,CAAtB;;AACA,IAAIG,mBAAJ;;AACA,CAAC,UAAUA,mBAAV,EAA+B;AAC5BA,EAAAA,mBAAmB,CAACA,mBAAmB,CAAC,OAAD,CAAnB,GAA+B,CAAhC,CAAnB,GAAwD,OAAxD;AACAA,EAAAA,mBAAmB,CAACA,mBAAmB,CAAC,OAAD,CAAnB,GAA+B,CAAhC,CAAnB,GAAwD,OAAxD;AACAA,EAAAA,mBAAmB,CAACA,mBAAmB,CAAC,OAAD,CAAnB,GAA+B,CAAhC,CAAnB,GAAwD,OAAxD;AACAA,EAAAA,mBAAmB,CAACA,mBAAmB,CAAC,UAAD,CAAnB,GAAkC,CAAnC,CAAnB,GAA2D,UAA3D;AACAA,EAAAA,mBAAmB,CAACA,mBAAmB,CAAC,YAAD,CAAnB,GAAoC,CAArC,CAAnB,GAA6D,YAA7D;AACH,CAND,EAMGA,mBAAmB,KAAKA,mBAAmB,GAAG,EAA3B,CANtB;;AAOA,IAAIC,uBAAJ;;AACA,CAAC,UAAUA,uBAAV,EAAmC;AAChCA,EAAAA,uBAAuB,CAACA,uBAAuB,CAAC,QAAD,CAAvB,GAAoC,CAArC,CAAvB,GAAiE,QAAjE;AACAA,EAAAA,uBAAuB,CAACA,uBAAuB,CAAC,MAAD,CAAvB,GAAkC,CAAnC,CAAvB,GAA+D,MAA/D;AACAA,EAAAA,uBAAuB,CAACA,uBAAuB,CAAC,SAAD,CAAvB,GAAqC,CAAtC,CAAvB,GAAkE,SAAlE;AACH,CAJD,EAIGA,uBAAuB,KAAKA,uBAAuB,GAAG,EAA/B,CAJ1B,E,CAKA;;;AACA,IAAIN,WAAW,GAAkB,UAAUO,MAAV,EAAkB;AAC/CzC,EAAAA,SAAS,CAACkC,WAAD,EAAcO,MAAd,CAAT;AACA;AACJ;AACA;AACA;AACA;;;AACI,WAASP,WAAT,CAAqBQ,QAArB,EAA+BC,OAA/B,EAAwC;AACpC,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAI,OAAOF,QAAP,KAAoB,QAAxB,EAAkC;AAC9BA,MAAAA,QAAQ,GAAGtB,SAAX;AACAuB,MAAAA,OAAO,GAAGD,QAAV;AACH;;AACDE,IAAAA,KAAK,GAAGH,MAAM,CAAC9B,IAAP,CAAY,IAAZ,EAAkB+B,QAAlB,EAA4BC,OAA5B,KAAwC,IAAhD;AACA,WAAOC,KAAP;AACH;;AACDV,EAAAA,WAAW,CAACzB,SAAZ,CAAsBoC,KAAtB,GAA8B,YAAY;AACtC,QAAIC,EAAJ,EAAQC,EAAR;;AACA,QAAIC,IAAI,GAAG,EAAX;AACA,QAAIC,QAAQ,GAAGC,aAAa,CAACC,WAAD,EAAc,KAAKC,GAAnB,CAA5B;;AACA,QAAIH,QAAJ,EAAc;AACV,UAAIA,QAAQ,CAACI,IAAT,KAAkB,MAAtB,EAA8B;AAC1B,YAAIC,MAAM,GAAGL,QAAQ,CAACM,QAAtB;AACAP,QAAAA,IAAI,CAACQ,IAAL,GAAY,MAAZ;AACAC,QAAAA,gBAAgB,CAACT,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmBM,MAAnB,CAAhB;AACAG,QAAAA,gBAAgB,CAACT,IAAD,EAAO,OAAP,EAAgB,OAAhB,EAAyBM,MAAzB,CAAhB;AACA,YAAII,IAAI,GAAGC,YAAY,CAAC,MAAD,EAAST,aAAa,CAAC,MAAD,EAASI,MAAT,CAAtB,CAAvB;;AACA,YAAII,IAAJ,EAAU;AACNV,UAAAA,IAAI,CAACY,IAAL,GAAYF,IAAZ;AACH;;AACDD,QAAAA,gBAAgB,CAACT,IAAD,EAAO,aAAP,EAAsB,UAAtB,EAAkCM,MAAlC,CAAhB;AACA,YAAIO,OAAO,GAAGC,KAAK,CAAC,SAAD,EAAYR,MAAZ,CAAnB;;AACA,YAAIO,OAAJ,EAAa;AACTb,UAAAA,IAAI,CAACa,OAAL,GAAe,IAAIE,IAAJ,CAASF,OAAT,CAAf;AACH;;AACDJ,QAAAA,gBAAgB,CAACT,IAAD,EAAO,QAAP,EAAiB,OAAjB,EAA0BM,MAA1B,EAAkC,IAAlC,CAAhB;AACAN,QAAAA,IAAI,CAACgB,KAAL,GAAaC,WAAW,CAAC,OAAD,EAAUX,MAAV,CAAX,CAA6BY,GAA7B,CAAiC,UAAUC,IAAV,EAAgB;AAC1D,cAAIC,KAAK,GAAG,EAAZ;AACA,cAAIb,QAAQ,GAAGY,IAAI,CAACZ,QAApB;AACAE,UAAAA,gBAAgB,CAACW,KAAD,EAAQ,IAAR,EAAc,IAAd,EAAoBb,QAApB,CAAhB;AACAE,UAAAA,gBAAgB,CAACW,KAAD,EAAQ,OAAR,EAAiB,OAAjB,EAA0Bb,QAA1B,CAAhB;AACA,cAAIG,IAAI,GAAGC,YAAY,CAAC,MAAD,EAAST,aAAa,CAAC,MAAD,EAASK,QAAT,CAAtB,CAAvB;;AACA,cAAIG,IAAJ,EAAU;AACNU,YAAAA,KAAK,CAACR,IAAN,GAAaF,IAAb;AACH;;AACD,cAAIW,WAAW,GAAGP,KAAK,CAAC,SAAD,EAAYP,QAAZ,CAAL,IACdO,KAAK,CAAC,SAAD,EAAYP,QAAZ,CADT;;AAEA,cAAIc,WAAJ,EAAiB;AACbD,YAAAA,KAAK,CAACC,WAAN,GAAoBA,WAApB;AACH;;AACD,cAAIC,OAAO,GAAGR,KAAK,CAAC,SAAD,EAAYP,QAAZ,CAAnB;;AACA,cAAIe,OAAJ,EAAa;AACTF,YAAAA,KAAK,CAACE,OAAN,GAAgB,IAAIP,IAAJ,CAASO,OAAT,CAAhB;AACH;;AACDF,UAAAA,KAAK,CAACG,KAAN,GAAcC,gBAAgB,CAACjB,QAAD,CAA9B;AACA,iBAAOa,KAAP;AACH,SApBY,CAAb;AAqBH,OApCD,MAqCK;AACD,YAAId,MAAM,GAAG,CAACP,EAAE,GAAG,CAACD,EAAE,GAAGI,aAAa,CAAC,SAAD,EAAYD,QAAQ,CAACM,QAArB,CAAnB,MAAuD,IAAvD,IAA+DT,EAAE,KAAK,KAAK,CAA3E,GAA+E,KAAK,CAApF,GAAwFA,EAAE,CAACS,QAAjG,MAA+G,IAA/G,IAAuHR,EAAE,KAAK,KAAK,CAAnI,GAAuIA,EAAvI,GAA4I,EAAzJ;AACAC,QAAAA,IAAI,CAACQ,IAAL,GAAYP,QAAQ,CAACI,IAAT,CAAcoB,MAAd,CAAqB,CAArB,EAAwB,CAAxB,CAAZ;AACAzB,QAAAA,IAAI,CAAC0B,EAAL,GAAU,EAAV;AACAjB,QAAAA,gBAAgB,CAACT,IAAD,EAAO,OAAP,EAAgB,OAAhB,EAAyBM,MAAzB,CAAhB;AACAG,QAAAA,gBAAgB,CAACT,IAAD,EAAO,MAAP,EAAe,MAAf,EAAuBM,MAAvB,CAAhB;AACAG,QAAAA,gBAAgB,CAACT,IAAD,EAAO,aAAP,EAAsB,aAAtB,EAAqCM,MAArC,CAAhB;AACA,YAAIO,OAAO,GAAGC,KAAK,CAAC,eAAD,EAAkBR,MAAlB,CAAnB;;AACA,YAAIO,OAAJ,EAAa;AACTb,UAAAA,IAAI,CAACa,OAAL,GAAe,IAAIE,IAAJ,CAASF,OAAT,CAAf;AACH;;AACDJ,QAAAA,gBAAgB,CAACT,IAAD,EAAO,QAAP,EAAiB,gBAAjB,EAAmCM,MAAnC,EAA2C,IAA3C,CAAhB;AACAN,QAAAA,IAAI,CAACgB,KAAL,GAAaC,WAAW,CAAC,MAAD,EAAShB,QAAQ,CAACM,QAAlB,CAAX,CAAuCW,GAAvC,CAA2C,UAAUC,IAAV,EAAgB;AACpE,cAAIC,KAAK,GAAG,EAAZ;AACA,cAAIb,QAAQ,GAAGY,IAAI,CAACZ,QAApB;AACAE,UAAAA,gBAAgB,CAACW,KAAD,EAAQ,IAAR,EAAc,MAAd,EAAsBb,QAAtB,CAAhB;AACAE,UAAAA,gBAAgB,CAACW,KAAD,EAAQ,OAAR,EAAiB,OAAjB,EAA0Bb,QAA1B,CAAhB;AACAE,UAAAA,gBAAgB,CAACW,KAAD,EAAQ,MAAR,EAAgB,MAAhB,EAAwBb,QAAxB,CAAhB;AACAE,UAAAA,gBAAgB,CAACW,KAAD,EAAQ,aAAR,EAAuB,aAAvB,EAAsCb,QAAtC,CAAhB;AACA,cAAIe,OAAO,GAAGR,KAAK,CAAC,SAAD,EAAYP,QAAZ,CAAnB;AACA,cAAIe,OAAJ,EACIF,KAAK,CAACE,OAAN,GAAgB,IAAIP,IAAJ,CAASO,OAAT,CAAhB;AACJF,UAAAA,KAAK,CAACG,KAAN,GAAcC,gBAAgB,CAACjB,QAAD,CAA9B;AACA,iBAAOa,KAAP;AACH,SAZY,CAAb;AAaH;AACJ;;AACD,SAAKpB,IAAL,GAAYA,IAAZ;AACA,SAAK2B,cAAL,CAAoB1B,QAAQ,GAAG,IAAH,GAAU2B,KAAK,CAAC,4BAAD,CAA3C;AACH,GAvED;;AAwEA,SAAO1C,WAAP;AACH,CAzFgC,CAyF/BC,YAAY,CAAC0C,OAzFkB,CAAjC;;AA0FA7C,OAAO,CAACE,WAAR,GAAsBA,WAAtB;;AACA,SAASsC,gBAAT,CAA0BM,KAA1B,EAAiC;AAC7B,SAAOb,WAAW,CAAC,eAAD,EAAkBa,KAAlB,CAAX,CAAoCZ,GAApC,CAAwC,UAAUa,IAAV,EAAgB;AAC3D,QAAIR,KAAK,GAAG;AACRS,MAAAA,MAAM,EAAED,IAAI,CAACE,OAAL,CAAaD,MADb;AAERE,MAAAA,SAAS,EAAE,CAAC,CAACH,IAAI,CAACE,OAAL,CAAaC;AAFlB,KAAZ;;AAIA,QAAIH,IAAI,CAACE,OAAL,CAAaE,GAAjB,EAAsB;AAClBZ,MAAAA,KAAK,CAACY,GAAN,GAAYJ,IAAI,CAACE,OAAL,CAAaE,GAAzB;AACH;;AACD,QAAIJ,IAAI,CAACE,OAAL,CAAaG,QAAjB,EAA2B;AACvBb,MAAAA,KAAK,CAACa,QAAN,GAAiBC,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaG,QAAd,EAAwB,EAAxB,CAAzB;AACH;;AACD,QAAIL,IAAI,CAACE,OAAL,CAAazB,IAAjB,EAAuB;AACnBe,MAAAA,KAAK,CAACf,IAAN,GAAauB,IAAI,CAACE,OAAL,CAAazB,IAA1B;AACH;;AACD,QAAIuB,IAAI,CAACE,OAAL,CAAaK,UAAjB,EAA6B;AACzBf,MAAAA,KAAK,CAACe,UAAN,GAAmBP,IAAI,CAACE,OAAL,CACdK,UADL;AAEH;;AACD,QAAIP,IAAI,CAACE,OAAL,CAAaM,OAAjB,EAA0B;AACtBhB,MAAAA,KAAK,CAACgB,OAAN,GAAgBF,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaM,OAAd,EAAuB,EAAvB,CAAxB;AACH;;AACD,QAAIR,IAAI,CAACE,OAAL,CAAaO,SAAjB,EAA4B;AACxBjB,MAAAA,KAAK,CAACiB,SAAN,GAAkBH,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaO,SAAd,EAAyB,EAAzB,CAA1B;AACH;;AACD,QAAIT,IAAI,CAACE,OAAL,CAAaQ,YAAjB,EAA+B;AAC3BlB,MAAAA,KAAK,CAACkB,YAAN,GAAqBJ,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaQ,YAAd,EAA4B,EAA5B,CAA7B;AACH;;AACD,QAAIV,IAAI,CAACE,OAAL,CAAaS,QAAjB,EAA2B;AACvBnB,MAAAA,KAAK,CAACmB,QAAN,GAAiBL,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaS,QAAd,EAAwB,EAAxB,CAAzB;AACH;;AACD,QAAIX,IAAI,CAACE,OAAL,CAAaU,QAAjB,EAA2B;AACvBpB,MAAAA,KAAK,CAACoB,QAAN,GAAiBN,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaU,QAAd,EAAwB,EAAxB,CAAzB;AACH;;AACD,QAAIZ,IAAI,CAACE,OAAL,CAAaW,MAAjB,EAAyB;AACrBrB,MAAAA,KAAK,CAACqB,MAAN,GAAeP,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaW,MAAd,EAAsB,EAAtB,CAAvB;AACH;;AACD,QAAIb,IAAI,CAACE,OAAL,CAAaY,KAAjB,EAAwB;AACpBtB,MAAAA,KAAK,CAACsB,KAAN,GAAcR,QAAQ,CAACN,IAAI,CAACE,OAAL,CAAaY,KAAd,EAAqB,EAArB,CAAtB;AACH;;AACD,QAAId,IAAI,CAACE,OAAL,CAAaa,IAAjB,EAAuB;AACnBvB,MAAAA,KAAK,CAACuB,IAAN,GAAaf,IAAI,CAACE,OAAL,CAAaa,IAA1B;AACH;;AACD,WAAOvB,KAAP;AACH,GA3CM,CAAP;AA4CH;;AACD,SAASN,WAAT,CAAqB8B,OAArB,EAA8BjB,KAA9B,EAAqC;AACjC,SAAOzC,QAAQ,CAAC2D,oBAAT,CAA8BD,OAA9B,EAAuCjB,KAAvC,EAA8C,IAA9C,CAAP;AACH;;AACD,SAAS5B,aAAT,CAAuB6C,OAAvB,EAAgCE,IAAhC,EAAsC;AAClC,SAAO5D,QAAQ,CAAC2D,oBAAT,CAA8BD,OAA9B,EAAuCE,IAAvC,EAA6C,IAA7C,EAAmD,CAAnD,EAAsD,CAAtD,CAAP;AACH;;AACD,SAASnC,KAAT,CAAeiC,OAAf,EAAwBjB,KAAxB,EAA+BoB,OAA/B,EAAwC;AACpC,MAAIA,OAAO,KAAK,KAAK,CAArB,EAAwB;AAAEA,IAAAA,OAAO,GAAG,KAAV;AAAkB;;AAC5C,SAAO7D,QAAQ,CAAC8D,OAAT,CAAiB9D,QAAQ,CAAC2D,oBAAT,CAA8BD,OAA9B,EAAuCjB,KAAvC,EAA8CoB,OAA9C,EAAuD,CAAvD,CAAjB,EAA4EE,IAA5E,EAAP;AACH;;AACD,SAASzC,YAAT,CAAsBN,IAAtB,EAA4B0B,IAA5B,EAAkC;AAC9B,MAAI,CAACA,IAAL,EAAW;AACP,WAAO,IAAP;AACH;;AACD,MAAIE,OAAO,GAAGF,IAAI,CAACE,OAAnB;AACA,SAAOA,OAAO,CAAC5B,IAAD,CAAd;AACH;;AACD,SAASI,gBAAT,CAA0B4C,GAA1B,EAA+BC,IAA/B,EAAqCC,IAArC,EAA2CzB,KAA3C,EAAkDoB,OAAlD,EAA2D;AACvD,MAAIA,OAAO,KAAK,KAAK,CAArB,EAAwB;AAAEA,IAAAA,OAAO,GAAG,KAAV;AAAkB;;AAC5C,MAAIM,GAAG,GAAG1C,KAAK,CAACyC,IAAD,EAAOzB,KAAP,EAAcoB,OAAd,CAAf;AACA,MAAIM,GAAJ,EACIH,GAAG,CAACC,IAAD,CAAH,GAAYE,GAAZ;AACP;;AACD,SAASrD,WAAT,CAAqBzB,KAArB,EAA4B;AACxB,SAAOA,KAAK,KAAK,KAAV,IAAmBA,KAAK,KAAK,MAA7B,IAAuCA,KAAK,KAAK,SAAxD;AACH;;AACD,IAAI+E,cAAc,GAAG;AAAEC,EAAAA,OAAO,EAAE;AAAX,CAArB;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASzE,SAAT,CAAmBe,IAAnB,EAAyBL,OAAzB,EAAkC;AAC9B,MAAIA,OAAO,KAAK,KAAK,CAArB,EAAwB;AAAEA,IAAAA,OAAO,GAAG8D,cAAV;AAA2B;;AACrD,MAAIE,OAAO,GAAG,IAAIzE,WAAJ,CAAgBS,OAAhB,CAAd;AACA,MAAIL,QAAQ,CAACsE,MAAb,CAAoBD,OAApB,EAA6BhE,OAA7B,EAAsCkE,GAAtC,CAA0C7D,IAA1C;AACA,SAAO2D,OAAO,CAAC3D,IAAf;AACH;;AACDhB,OAAO,CAACC,SAAR,GAAoBA,SAApB","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.parseFeed = exports.FeedHandler = void 0;\nvar domhandler_1 = __importDefault(require(\"domhandler\"));\nvar DomUtils = __importStar(require(\"domutils\"));\nvar Parser_1 = require(\"./Parser\");\nvar FeedItemMediaMedium;\n(function (FeedItemMediaMedium) {\n    FeedItemMediaMedium[FeedItemMediaMedium[\"image\"] = 0] = \"image\";\n    FeedItemMediaMedium[FeedItemMediaMedium[\"audio\"] = 1] = \"audio\";\n    FeedItemMediaMedium[FeedItemMediaMedium[\"video\"] = 2] = \"video\";\n    FeedItemMediaMedium[FeedItemMediaMedium[\"document\"] = 3] = \"document\";\n    FeedItemMediaMedium[FeedItemMediaMedium[\"executable\"] = 4] = \"executable\";\n})(FeedItemMediaMedium || (FeedItemMediaMedium = {}));\nvar FeedItemMediaExpression;\n(function (FeedItemMediaExpression) {\n    FeedItemMediaExpression[FeedItemMediaExpression[\"sample\"] = 0] = \"sample\";\n    FeedItemMediaExpression[FeedItemMediaExpression[\"full\"] = 1] = \"full\";\n    FeedItemMediaExpression[FeedItemMediaExpression[\"nonstop\"] = 2] = \"nonstop\";\n})(FeedItemMediaExpression || (FeedItemMediaExpression = {}));\n// TODO: Consume data as it is coming in\nvar FeedHandler = /** @class */ (function (_super) {\n    __extends(FeedHandler, _super);\n    /**\n     *\n     * @param callback\n     * @param options\n     */\n    function FeedHandler(callback, options) {\n        var _this = this;\n        if (typeof callback === \"object\") {\n            callback = undefined;\n            options = callback;\n        }\n        _this = _super.call(this, callback, options) || this;\n        return _this;\n    }\n    FeedHandler.prototype.onend = function () {\n        var _a, _b;\n        var feed = {};\n        var feedRoot = getOneElement(isValidFeed, this.dom);\n        if (feedRoot) {\n            if (feedRoot.name === \"feed\") {\n                var childs = feedRoot.children;\n                feed.type = \"atom\";\n                addConditionally(feed, \"id\", \"id\", childs);\n                addConditionally(feed, \"title\", \"title\", childs);\n                var href = getAttribute(\"href\", getOneElement(\"link\", childs));\n                if (href) {\n                    feed.link = href;\n                }\n                addConditionally(feed, \"description\", \"subtitle\", childs);\n                var updated = fetch(\"updated\", childs);\n                if (updated) {\n                    feed.updated = new Date(updated);\n                }\n                addConditionally(feed, \"author\", \"email\", childs, true);\n                feed.items = getElements(\"entry\", childs).map(function (item) {\n                    var entry = {};\n                    var children = item.children;\n                    addConditionally(entry, \"id\", \"id\", children);\n                    addConditionally(entry, \"title\", \"title\", children);\n                    var href = getAttribute(\"href\", getOneElement(\"link\", children));\n                    if (href) {\n                        entry.link = href;\n                    }\n                    var description = fetch(\"summary\", children) ||\n                        fetch(\"content\", children);\n                    if (description) {\n                        entry.description = description;\n                    }\n                    var pubDate = fetch(\"updated\", children);\n                    if (pubDate) {\n                        entry.pubDate = new Date(pubDate);\n                    }\n                    entry.media = getMediaElements(children);\n                    return entry;\n                });\n            }\n            else {\n                var childs = (_b = (_a = getOneElement(\"channel\", feedRoot.children)) === null || _a === void 0 ? void 0 : _a.children) !== null && _b !== void 0 ? _b : [];\n                feed.type = feedRoot.name.substr(0, 3);\n                feed.id = \"\";\n                addConditionally(feed, \"title\", \"title\", childs);\n                addConditionally(feed, \"link\", \"link\", childs);\n                addConditionally(feed, \"description\", \"description\", childs);\n                var updated = fetch(\"lastBuildDate\", childs);\n                if (updated) {\n                    feed.updated = new Date(updated);\n                }\n                addConditionally(feed, \"author\", \"managingEditor\", childs, true);\n                feed.items = getElements(\"item\", feedRoot.children).map(function (item) {\n                    var entry = {};\n                    var children = item.children;\n                    addConditionally(entry, \"id\", \"guid\", children);\n                    addConditionally(entry, \"title\", \"title\", children);\n                    addConditionally(entry, \"link\", \"link\", children);\n                    addConditionally(entry, \"description\", \"description\", children);\n                    var pubDate = fetch(\"pubDate\", children);\n                    if (pubDate)\n                        entry.pubDate = new Date(pubDate);\n                    entry.media = getMediaElements(children);\n                    return entry;\n                });\n            }\n        }\n        this.feed = feed;\n        this.handleCallback(feedRoot ? null : Error(\"couldn't find root of feed\"));\n    };\n    return FeedHandler;\n}(domhandler_1.default));\nexports.FeedHandler = FeedHandler;\nfunction getMediaElements(where) {\n    return getElements(\"media:content\", where).map(function (elem) {\n        var media = {\n            medium: elem.attribs.medium,\n            isDefault: !!elem.attribs.isDefault,\n        };\n        if (elem.attribs.url) {\n            media.url = elem.attribs.url;\n        }\n        if (elem.attribs.fileSize) {\n            media.fileSize = parseInt(elem.attribs.fileSize, 10);\n        }\n        if (elem.attribs.type) {\n            media.type = elem.attribs.type;\n        }\n        if (elem.attribs.expression) {\n            media.expression = elem.attribs\n                .expression;\n        }\n        if (elem.attribs.bitrate) {\n            media.bitrate = parseInt(elem.attribs.bitrate, 10);\n        }\n        if (elem.attribs.framerate) {\n            media.framerate = parseInt(elem.attribs.framerate, 10);\n        }\n        if (elem.attribs.samplingrate) {\n            media.samplingrate = parseInt(elem.attribs.samplingrate, 10);\n        }\n        if (elem.attribs.channels) {\n            media.channels = parseInt(elem.attribs.channels, 10);\n        }\n        if (elem.attribs.duration) {\n            media.duration = parseInt(elem.attribs.duration, 10);\n        }\n        if (elem.attribs.height) {\n            media.height = parseInt(elem.attribs.height, 10);\n        }\n        if (elem.attribs.width) {\n            media.width = parseInt(elem.attribs.width, 10);\n        }\n        if (elem.attribs.lang) {\n            media.lang = elem.attribs.lang;\n        }\n        return media;\n    });\n}\nfunction getElements(tagName, where) {\n    return DomUtils.getElementsByTagName(tagName, where, true);\n}\nfunction getOneElement(tagName, node) {\n    return DomUtils.getElementsByTagName(tagName, node, true, 1)[0];\n}\nfunction fetch(tagName, where, recurse) {\n    if (recurse === void 0) { recurse = false; }\n    return DomUtils.getText(DomUtils.getElementsByTagName(tagName, where, recurse, 1)).trim();\n}\nfunction getAttribute(name, elem) {\n    if (!elem) {\n        return null;\n    }\n    var attribs = elem.attribs;\n    return attribs[name];\n}\nfunction addConditionally(obj, prop, what, where, recurse) {\n    if (recurse === void 0) { recurse = false; }\n    var tmp = fetch(what, where, recurse);\n    if (tmp)\n        obj[prop] = tmp;\n}\nfunction isValidFeed(value) {\n    return value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n}\nvar defaultOptions = { xmlMode: true };\n/**\n * Parse a feed.\n *\n * @param feed The feed that should be parsed, as a string.\n * @param options Optionally, options for parsing. When using this option, you probably want to set `xmlMode` to `true`.\n */\nfunction parseFeed(feed, options) {\n    if (options === void 0) { options = defaultOptions; }\n    var handler = new FeedHandler(options);\n    new Parser_1.Parser(handler, options).end(feed);\n    return handler.feed;\n}\nexports.parseFeed = parseFeed;\n"]},"metadata":{},"sourceType":"script"}