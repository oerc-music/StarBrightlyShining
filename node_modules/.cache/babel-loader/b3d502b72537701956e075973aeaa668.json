{"ast":null,"code":"var _jsxFileName = \"/Users/mark/localRepos/StarBrightlyShining/src/containers/app.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport update from 'immutability-helper';\nimport { registerTraversal, traverse, setTraversalObjectives, checkTraversalObjectives } from 'meld-clients-core/lib/actions/index';\nimport { prefix as pref } from 'meld-clients-core/lib/library/prefixes';\nimport { fetchGraph } from 'meld-clients-core/lib/actions/index';\nimport VersionPane from './versionPane';\nimport VersionListing from './versionListing';\nimport WorkListing from './workListing';\nimport SelectableScore from 'selectable-score/lib/selectable-score';\nimport NextPageButton from 'selectable-score/lib/next-page-button.js';\nimport PrevPageButton from 'selectable-score/lib/prev-page-button.js';\nimport SubmitButton from 'selectable-score/lib/submit-button.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MAX_TRAVERSERS = 5; // selectionString: CSS selector for all elements to be selectable (e.g. \".measure\", \".note\")\n//const selectorString = \".measure\";\n//const selectorString = \".notehead\";\n\nconst selectorStrings = {\n  note: \".notehead, .stem, .verse\",\n  measure: \".measure\"\n};\npref.bith = \"https://example.com/\";\npref.bithTerms = \"https://example.com/Terms/\";\npref.bibo = \"http://purl.org/ontology/bibo/\";\npref.gndo = \"https://d-nb.info/standards/elementset/gnd#\";\npref.dce = \"http://purl.org/dc/elements/1.1/\";\npref.dbpedia = \"https://dbpedia.org/ontology/\";\npref.rdau = \"http://rdaregistry.info/Elements/u/\";\npref.wdt = \"https://www.wikidata.org/prop/direct/\";\nconst basicVrvOptions = {\n  scale: 45,\n  header: \"none\",\n  adjustPageHeight: 1,\n  pageHeight: 800,\n  pageWidth: 2200,\n  footer: \"none\",\n  unit: 6\n};\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      mode: 'work',\n      //\t\t\tmode: 'compare',\n      // mode: 'version',\n      versions: [false, false],\n      work: false,\n      worklist: [],\n      targetting: 'note',\n      multiSelect: false,\n      // selector: '.notehead, .stem, .verse',\n      selection: {},\n      width: 1200,\n      height: 800,\n      annotations: [],\n      uri: this.props.uri,\n      arrangements: false\n    };\n    this.handleScoreUpdate = this.handleScoreUpdate.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.selectMeasures = this.selectMeasures.bind(this);\n    this.selectNotes = this.selectNotes.bind(this);\n    this.usefulIdForChildElement = this.usefulIdForChildElement.bind(this);\n    this.makeMusicalMaterialFromSelection = this.makeMusicalMaterialFromSelection.bind(this);\n    this.makeSelectionJSONLDFromSelection = this.makeSelectionJSONLDFromSelection.bind(this);\n    this.makeExtractFromSelection = this.makeExtractFromSelection.bind(this);\n    this.renderVersionInList = this.renderVersionInList.bind(this);\n    this.renderWorkInList = this.renderWorkInList.bind(this);\n    this.handleAddVersionPane = this.handleAddVersionPane.bind(this);\n    this.props.setTraversalObjectives([{\n      \"@embed\": \"@always\",\n      \"http://rdaregistry.info/Elements/u/P60242\": {}\n    }, {\n      \"@type\": pref.bith + \"MusicalMaterial\"\n    }]);\n  } // Life cycle methods\n\n\n  componentDidMount() {\n    // See: https://reactjs.org/docs/react-component.html#componentdidmount\n    if (this.props.graphURI) {\n      this.props.registerTraversal(this.props.graphURI, {\n        numHops: 3\n      });\n    }\n\n    window.addEventListener(\"resize\", this.updateDimensions.bind(this));\n  }\n\n  updateDimensions() {\n    this.setState({\n      width: document.documentElement.clientWidth,\n      height: document.documentElement.clientHeight\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    // See: https://reactjs.org/docs/react-component.html#componentdidupdate\n    if (prevProps && \"graph\" in prevProps) {\n      if (this.graphComponentDidUpdate(this.props, prevProps, prevState)) {\n        this.graphHasChanged();\n      }\n    }\n  }\n\n  transformArrangement(vivoScore) {\n    // Take graph of arrangement and make more intuitive local object\n    let obj = {};\n    obj.shortTitle = vivoScore[pref.bibo + \"shortTitle\"];\n    obj.genre = pref.dbpedia + \"genre\" in vivoScore ? vivoScore[pref.dbpedia + \"genre\"]['@id'] : false;\n    obj.arranger = vivoScore[pref.gndo + 'arranger']; // Change so we have name, not URL\n\n    obj.publisher = vivoScore[pref.dce + \"publisher\"]; // Change so we have name, not URL\n\n    obj.date = vivoScore[pref.gndo + \"dateOfPublication\"];\n    obj.MEI = pref.frbr + \"embodiment\" in vivoScore ? vivoScore[pref.frbr + \"embodiment\"]['@id'] : false;\n    obj.place = vivoScore[pref.rdau + \"P60163\"]; //    obj.catNumber = pref.wdt+\"P217\" in vivoScore ? vivoScore[pref.wdt+\"P217\"]['@id'] : false;\n\n    obj.catNumber = vivoScore[pref.wdt + \"P217\"];\n    obj.work = vivoScore[pref.rdau + \"P60242\"];\n    console.log(\"Processed a \", vivoScore, \" into a \", obj);\n    return obj;\n  } // methods called during initialisation and graph loading\n\n\n  addWork(worklist, arrangement) {\n    if (!arrangement.work || !'@id' in arrangement.work) return workList;\n    const wID = arrangement.work['@id'];\n\n    if (worklist.find(x => x['@id'] === wID)) {\n      return worklist;\n    } else {\n      let wl2 = worklist.slice();\n      wl2.push(arrangement.work);\n      return wl2;\n    }\n  }\n\n  graphHasChanged() {\n    let arrangements = [];\n    let worklist = []; // 0. Get arrangements\n\n    if (this.props.graph && this.props.graph.outcomes && this.props.graph.outcomes[0] && this.props.graph.outcomes[0]['@graph'] && this.props.graph.outcomes[0]['@graph'].length) {\n      arrangements = this.props.graph.outcomes[0]['@graph'].map(this.transformArrangement); // Extract all unique works from the arrangements list\n\n      worklist = arrangements.reduce(this.addWork, []);\n    } // 1. convert this.graph.outcomes[0] into this.state.worklist\n\n\n    this.setState({\n      arrangements: arrangements,\n      worklist: worklist\n    });\n  }\n\n  graphComponentDidUpdate(props, prevProps, prevState) {\n    // Boiler plate traversal code (should move to m-c-c)\n    // Check whether the graph has updated and trigger further traversal as necessary.\n    // Called by this.componentDidUpdate\n    var prevPool = prevProps.traversalPool;\n    var thisPool = props.traversalPool;\n    var updated = false;\n\n    if (prevPool.running === 1 && thisPool.running === 0) {\n      // check our traversal objectives if the graph has updated\n      props.checkTraversalObjectives(props.graph.graph, props.graph.objectives);\n      updated = true;\n    } else if (Object.keys(thisPool.pool).length && thisPool.running < MAX_TRAVERSERS) {\n      // Initiate next traverser in pool...\n      var uri = Object.keys(thisPool.pool)[0];\n      props.traverse(uri, thisPool.pool[uri]);\n\n      if (prevProps.graph.outcomesHash !== props.graph.outcomesHash) {\n        updated = true;\n      }\n    } else if (props.traversalPool.running === 0) {\n      if (prevProps.graph.outcomesHash !== props.graph.outcomesHash) {\n        updated = true;\n      }\n    }\n\n    return updated;\n  } // UI methods\n\n\n  selectMeasures() {\n    this.setState({\n      targetting: 'measure'\n    });\n  }\n\n  selectNotes() {\n    this.setState({\n      targetting: 'note'\n    });\n  }\n\n  usefulIdForChildElement(element) {\n    console.log(element);\n\n    if (element.classList.contains(this.state.targetting)) {\n      return element.id;\n    } else if (this.state.targetting === 'note' && element.classList.contains('chord')) {\n      // Ugly exception – chords have a stem that applies to all notes\n      return Array.from(element.getElementsByClassName('note')).map(x => x.id);\n    } else if (!element.parentNode.parentNode) {\n      return false;\n    } else {\n      return this.usefulIdForChildElement(element.parentNode);\n    }\n  }\n\n  handleNoteSelectionChange(key, selection) {\n    // We need to replace this.state.selection[key] with the notes that contain newSelection\n    const selectionIds = selection.map(this.usefulIdForChildElement).flat();\n    this.handleSelectionChange(key, selectionIds);\n  }\n\n  handleMeasureSelectionChange(key, selection) {\n    // We need to replace this.state.selection[key] with the notes that contain newSelection\n    const selectionIds = selection.map(x => x.id);\n    this.handleSelectionChange(key, selectionIds);\n  }\n\n  handleSelectionChange(key, selectionIds) {\n    const pane = document.getElementById(key);\n    const selectedElements = Array.from(pane.getElementsByClassName('selected'));\n    const newSelection = { ...this.state.selection\n    };\n    selectedElements.forEach(thing => thing.classList.remove('selected'));\n    selectionIds.forEach(e => document.getElementById(e).classList.add('selected'));\n    newSelection[key] = selectionIds;\n    this.setState({\n      selection: newSelection,\n      multiSelect: Object.keys(newSelection).length > 1 && Object.values(newSelection).filter(x => x.length).length > 1\n    });\n  }\n\n  addElementToSelectionObject(object, resourceURI, element) {\n    if (!(pref.frbr + \"part\" in object)) object[pref.frbr + \"part\"] = [];\n    object[pref.frbr + \"part\"].push(resourceURI + \"#\" + element);\n    return object;\n  }\n\n  makeSelectionJSONLDFromSelection(uri) {\n    const selectionObject = {\n      \"@type\": pref.bithTerms + \"Selection\"\n    };\n    this.state.selection[uri].forEach(this.addElementToSelectionObject.bind(this, selectionObject, uri));\n    return selectionObject;\n  }\n\n  makeExtractFromSelection(uri) {\n    const extractObject = {\n      \"@type\": pref.bithTerms + \"Extract\"\n    };\n    extractObject[pref.frbr + \"member\"] = [this.makeSelectionJSONLDFromSelection(uri)];\n    return extractObject;\n  }\n\n  makeMusicalMaterialFromSelection() {\n    const uris = Object.keys(this.state.selection);\n    const now = new Date();\n    let mm = {\n      \"@type\": pref.bithTerms + \"MusicalMaterial\"\n    };\n    mm[pref.dct + \"created\"] = now.toISOString();\n    mm[pref.frbr + \"embodiment\"] = uris.map(this.makeExtractFromSelection);\n    this.setState(update(this.state, {\n      annotations: {\n        $push: [mm]\n      }\n    }));\n  }\n\n  handleScoreUpdate(scoreElement) {\n    console.log(\"Received updated score DOM element: \", scoreElement);\n  }\n\n  handleChooseWork(work) {\n    this.setState({\n      mode: 'version',\n      work: work\n    });\n  }\n\n  handleChooseVersion(version) {\n    this.setState({\n      mode: 'score',\n      versions: [version, false]\n    });\n  }\n\n  handleReplaceVersion(version, replacePos) {\n    // Swap out one of the versions\n    let versions = this.state.versions.slice();\n    versions[replacePos] = version;\n    this.setState({\n      mode: 'compare',\n      versions: versions\n    });\n  }\n\n  handleAddVersionPane() {\n    this.setState({\n      mode: 'addVersion'\n    });\n  }\n\n  handleSubmit(args) {\n    /* do any app-specific actions and return the object (e.g. a Web Annotation)\n     * to be submitted to the user POD */\n    console.log(\"Received args: \", args);\n    return {\n      \"@context\": \"http://www.w3.org/ns/anno.jsonld\",\n      \"target\": this.state.selection.map(elem => this.state.uri + \"#\" + elem.getAttribute(\"id\")),\n      \"motivation\": \"highlighting\"\n    };\n  }\n\n  render() {\n    switch (this.state.mode) {\n      case 'version':\n        return this.renderVersions();\n\n      case 'addVersion':\n        return this.renderVersions();\n\n      case 'score':\n        return this.renderSingleScore();\n\n      case 'compare':\n        return this.renderTiledScores();\n\n      case 'work':\n      default:\n        return this.renderWorks();\n    }\n  } // renderWorkInList(work){\n  // \t// Each work is drawn separately to the works list\n  // \treturn <div className=\"workListing\" onClick={ this.handleChooseWork.bind(this, work) }>{ work.title}</div> ;\n  // }\n\n\n  renderWorkInList(work) {\n    const handler = this.handleChooseWork.bind(this, work);\n    return /*#__PURE__*/_jsxDEV(WorkListing, {\n      shortTitle: work[pref.rdfs + \"label\"],\n      composer: work[pref.rdau + \"P60426\"][pref.rdfs + \"label\"],\n      opus: work[pref.gndo + \"opusNumericDesignationOfMusicalWork\"],\n      date: work[pref.gndo + \"dateOfPublication\"],\n      clickHandler: handler\n    }, work['@id'], false, {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 14\n    }, this);\n  }\n\n  renderVersionInList(version) {\n    // Each verison is drawn separately to the versions list\n    const handler = this.state.mode === \"version\" ? this.handleChooseVersion.bind(this, version) : this.handleReplaceVersion.bind(this, version, 1);\n    return /*#__PURE__*/_jsxDEV(VersionListing, {\n      clickHandler: handler,\n      ...version\n    }, version.shortTitle, false, {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 10\n    }, this);\n  }\n\n  renderWorks() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"works\",\n      children: this.state.worklist.map(this.renderWorkInList)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 4\n    }, this);\n  }\n\n  renderWorkAsHeader(work) {\n    if (!work) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 11\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 11\n      }, this);\n    }\n  }\n\n  renderVersions() {\n    if (!this.state.arrangements.length) return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 46\n    }, this);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"work\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"workInfo\",\n        children: this.renderWorkAsHeader(this.work)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"versions\",\n        children: this.work ? this.state.arrangements.filter(x => x.work === this.work).map(this.renderVersionInList) : this.state.arrangements.map(this.renderVersionInList)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 4\n    }, this);\n  }\n\n  selectionRadioButton(target, callback) {\n    return /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"radio\",\n      name: \"target\",\n      checked: this.state.targetting === target,\n      className: this.state.targetting === target ? \"checked\" : \"unchecked\",\n      onChange: callback,\n      value: target,\n      id: target\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 10\n    }, this);\n  }\n\n  annotationButtons() {\n    if (this.state.multiSelect) {\n      return /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"musicalMaterial annotationButton\",\n        onClick: this.makeMusicalMaterialFromSelection,\n        children: \"Parallel passages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 345,\n        columnNumber: 5\n      }, this);\n    }\n  }\n\n  renderTiledScores() {\n    // MEI URIs hardwired for testing\n    if (!this.state.versions[0] && this.state.versions[1]) return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 64\n    }, this);\n    const upperURI = this.state.arrangements.length ? this.state.arrangements[0].MEI : \"https://meld.linkedmusic.org/companion/mei/F1.mei\"; //    const upperURI = \"https://raw.githubusercontent.com/DomesticBeethoven/data/main/op.%2092/ChorHallberger%20-%20D-BNba%20Nc%204_1846%20Schil/D-BNbaNc4_1846_Schil.mei>\";\n\n    const lowerURI = \"https://meld.linkedmusic.org/companion/mei/F2.mei\";\n    const upper = this.state.versions[0];\n    const lower = this.state.versions[1];\n    const selectionHandler = this.state.targetting === 'note' ? this.handleNoteSelectionChange : this.handleMeasureSelectionChange;\n    const narrowWindow = this.state.width < 800;\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Select:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"target switch-field\",\n        children: [this.selectionRadioButton('measure', this.selectMeasures), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"measure\",\n          children: \"Measures\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 6\n        }, this), this.selectionRadioButton('note', this.selectNotes), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"note\",\n          children: \"Notes\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 5\n      }, this), this.annotationButtons(), /*#__PURE__*/_jsxDEV(VersionPane, {\n        extraClasses: \"upper\",\n        id: \"pane1\",\n        narrowPane: narrowWindow,\n        width: this.state.width,\n        uri: upper.MEI //  shortTitle=\"Star Brightly Shining\"\n        ,\n        shortTitle: upper.shortTitle,\n        arranger: \"Josiah Pittman\",\n        genre: \"Piano-vocal\",\n        publisher: \"Augener & Co.\",\n        date: upper.date,\n        place: \"London\",\n        catNumber: upper.catNumber,\n        vrvOptions: basicVrvOptions,\n        selectionHandler: selectionHandler.bind(this, upperURI),\n        selectorString: selectorStrings[this.state.targetting],\n        handleScoreUpdate: this.handleScoreUpdate\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(VersionPane, {\n        extraClasses: \"lower\",\n        width: this.state.width,\n        id: \"pane1\",\n        shortTitle: lower.shortTitle,\n        arranger: \"Friedrich Silcher\",\n        genre: \"Choral music\",\n        publisher: \"Hallberger\",\n        date: \"1846\",\n        place: \"Stuttgart\",\n        catNumber: lower.catNumber,\n        uri: lower.MEI,\n        vrvOptions: basicVrvOptions,\n        selectionHandler: selectionHandler.bind(this, lowerURI),\n        selectorString: selectorStrings[this.state.targetting],\n        handleScoreUpdate: this.handleScoreUpdate\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 4\n    }, this);\n  }\n\n  renderSingleScore() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Current selection: \", this.state.selection.length > 0 ? /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\" \", this.state.selection.map(elem => elem.getAttribute(\"id\")).join(\", \"), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Nothing selected\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(NextPageButton, {\n        buttonContent: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 29\n        }, this),\n        uri: this.state.uri\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(PrevPageButton, {\n        buttonContent: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Prev\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 29\n        }, this),\n        uri: this.state.uri\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 424,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"addPane\",\n        onClick: this.handleAddVersionPane,\n        children: \"+\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 428,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(SelectableScore, {\n        uri: this.state.versions[0].MEI,\n        options: this.props.vrvOptions,\n        onSelectionChange: this.handleSelectionChange,\n        selectorString: selectorStrings[this.state.targetting],\n        onScoreUpdate: this.handleScoreUpdate\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 432,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nfunction mapStateToProps({\n  graph,\n  score,\n  traversalPool\n}) {\n  return {\n    graph,\n    score,\n    traversalPool\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({\n    registerTraversal,\n    traverse,\n    setTraversalObjectives,\n    checkTraversalObjectives,\n    fetchGraph\n  }, dispatch);\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);","map":{"version":3,"sources":["/Users/mark/localRepos/StarBrightlyShining/src/containers/app.js"],"names":["React","Component","connect","bindActionCreators","update","registerTraversal","traverse","setTraversalObjectives","checkTraversalObjectives","prefix","pref","fetchGraph","VersionPane","VersionListing","WorkListing","SelectableScore","NextPageButton","PrevPageButton","SubmitButton","MAX_TRAVERSERS","selectorStrings","note","measure","bith","bithTerms","bibo","gndo","dce","dbpedia","rdau","wdt","basicVrvOptions","scale","header","adjustPageHeight","pageHeight","pageWidth","footer","unit","App","constructor","props","state","mode","versions","work","worklist","targetting","multiSelect","selection","width","height","annotations","uri","arrangements","handleScoreUpdate","bind","handleSubmit","selectMeasures","selectNotes","usefulIdForChildElement","makeMusicalMaterialFromSelection","makeSelectionJSONLDFromSelection","makeExtractFromSelection","renderVersionInList","renderWorkInList","handleAddVersionPane","componentDidMount","graphURI","numHops","window","addEventListener","updateDimensions","setState","document","documentElement","clientWidth","clientHeight","componentDidUpdate","prevProps","prevState","graphComponentDidUpdate","graphHasChanged","transformArrangement","vivoScore","obj","shortTitle","genre","arranger","publisher","date","MEI","frbr","place","catNumber","console","log","addWork","arrangement","workList","wID","find","x","wl2","slice","push","graph","outcomes","length","map","reduce","prevPool","traversalPool","thisPool","updated","running","objectives","Object","keys","pool","outcomesHash","element","classList","contains","id","Array","from","getElementsByClassName","parentNode","handleNoteSelectionChange","key","selectionIds","flat","handleSelectionChange","handleMeasureSelectionChange","pane","getElementById","selectedElements","newSelection","forEach","thing","remove","e","add","values","filter","addElementToSelectionObject","object","resourceURI","selectionObject","extractObject","uris","now","Date","mm","dct","toISOString","$push","scoreElement","handleChooseWork","handleChooseVersion","version","handleReplaceVersion","replacePos","args","elem","getAttribute","render","renderVersions","renderSingleScore","renderTiledScores","renderWorks","handler","rdfs","renderWorkAsHeader","selectionRadioButton","target","callback","annotationButtons","upperURI","lowerURI","upper","lower","selectionHandler","narrowWindow","join","vrvOptions","mapStateToProps","score","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux' ;\nimport { bindActionCreators } from 'redux';\nimport update from 'immutability-helper';\nimport { registerTraversal, traverse, setTraversalObjectives, checkTraversalObjectives } from 'meld-clients-core/lib/actions/index';\nimport { prefix as pref } from 'meld-clients-core/lib/library/prefixes';\nimport { fetchGraph } from 'meld-clients-core/lib/actions/index';\nimport VersionPane from './versionPane';\nimport VersionListing from './versionListing';\nimport WorkListing from './workListing';\nimport SelectableScore from 'selectable-score/lib/selectable-score';\nimport NextPageButton from 'selectable-score/lib/next-page-button.js';\nimport PrevPageButton from 'selectable-score/lib/prev-page-button.js';\nimport SubmitButton from 'selectable-score/lib/submit-button.js';\n\nconst MAX_TRAVERSERS = 5;\n\n// selectionString: CSS selector for all elements to be selectable (e.g. \".measure\", \".note\")\n//const selectorString = \".measure\";\n//const selectorString = \".notehead\";\nconst selectorStrings = { note: \".notehead, .stem, .verse\", measure: \".measure\" };\n\npref.bith = \"https://example.com/\";\npref.bithTerms = \"https://example.com/Terms/\";\npref.bibo = \"http://purl.org/ontology/bibo/\";\npref.gndo = \"https://d-nb.info/standards/elementset/gnd#\";\npref.dce = \"http://purl.org/dc/elements/1.1/\";\npref.dbpedia = \"https://dbpedia.org/ontology/\";\npref.rdau = \"http://rdaregistry.info/Elements/u/\";\npref.wdt = \"https://www.wikidata.org/prop/direct/\";\n\nconst basicVrvOptions = {\n  scale: 45,\n\theader: \"none\",\n  adjustPageHeight: 1,\n  pageHeight: 800,\n  pageWidth: 2200,\n  footer: \"none\",\n  unit: 6\n};\n\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n\t\t\tmode: 'work',\n\t\t\t//\t\t\tmode: 'compare',\n\t\t\t// mode: 'version',\n\t\t\tversions: [false, false],\n\t\t\twork: false,\n\t\t\tworklist: [],\n\t\t\ttargetting: 'note',\n\t\t\tmultiSelect: false,\n\t\t\t// selector: '.notehead, .stem, .verse',\n      selection: {},\n\t\t\twidth: 1200,\n\t\t\theight: 800,\n\t\t\tannotations: [],\n      uri: this.props.uri,\n      arrangements: false\n    };\n    this.handleScoreUpdate = this.handleScoreUpdate.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n\t\tthis.selectMeasures = this.selectMeasures.bind(this);\n\t\tthis.selectNotes = this.selectNotes.bind(this);\n\t\tthis.usefulIdForChildElement = this.usefulIdForChildElement.bind(this);\n\t\tthis.makeMusicalMaterialFromSelection = this.makeMusicalMaterialFromSelection.bind(this);\n\t\tthis.makeSelectionJSONLDFromSelection = this.makeSelectionJSONLDFromSelection.bind(this);\n\t\tthis.makeExtractFromSelection = this.makeExtractFromSelection.bind(this);\n\t\tthis.renderVersionInList = this.renderVersionInList.bind(this);\n\t\tthis.renderWorkInList = this.renderWorkInList.bind(this);\n\t\tthis.handleAddVersionPane = this.handleAddVersionPane.bind(this);\n\t\tthis.props.setTraversalObjectives([\n\t\t\t{\n\t\t\t\t\"@embed\": \"@always\",\n\t\t\t\t\"http://rdaregistry.info/Elements/u/P60242\": {}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"@type\": pref.bith + \"MusicalMaterial\"\n\t\t\t}\n\t\t]);\n\t}\n\t// Life cycle methods\n\tcomponentDidMount(){\n    // See: https://reactjs.org/docs/react-component.html#componentdidmount\n    if(this.props.graphURI){\n      this.props.registerTraversal(this.props.graphURI, {numHops: 3});\n    }\n\t\twindow.addEventListener(\"resize\", this.updateDimensions.bind(this));\n  }\n  updateDimensions() {\n\t\tthis.setState({width: document.documentElement.clientWidth,\n\t\t\t\t\t\t\t\t\t height: document.documentElement.clientHeight});\n  }\n\n  componentDidUpdate(prevProps, prevState){\n    // See: https://reactjs.org/docs/react-component.html#componentdidupdate\n    if(prevProps && \"graph\" in prevProps) {\n      if ( this.graphComponentDidUpdate(this.props, prevProps, prevState ) ) {\n\t\t\t\tthis.graphHasChanged();\n      }\n    }\n\t}\n\ttransformArrangement(vivoScore){\n\t\t// Take graph of arrangement and make more intuitive local object\n\t\tlet obj = {};\n\t\tobj.shortTitle = vivoScore[pref.bibo+\"shortTitle\"];\n\t\tobj.genre = pref.dbpedia+\"genre\" in vivoScore ? vivoScore[pref.dbpedia+\"genre\"]['@id'] : false;\n\t\tobj.arranger = vivoScore[pref.gndo+'arranger']; // Change so we have name, not URL\n\t\tobj.publisher = vivoScore[pref.dce+\"publisher\"]; // Change so we have name, not URL\n\t\tobj.date = vivoScore[pref.gndo+\"dateOfPublication\"];\n\t\tobj.MEI = pref.frbr+\"embodiment\" in vivoScore ? vivoScore[pref.frbr+\"embodiment\"]['@id'] : false;\n\t\tobj.place = vivoScore[pref.rdau+\"P60163\"];\n//    obj.catNumber = pref.wdt+\"P217\" in vivoScore ? vivoScore[pref.wdt+\"P217\"]['@id'] : false;\n    obj.catNumber = vivoScore[pref.wdt+\"P217\"];\n\t\tobj.work = vivoScore[pref.rdau+\"P60242\"];\n\t\tconsole.log(\"Processed a \", vivoScore, \" into a \", obj);\n\t\treturn obj;\n\t}\n\t// methods called during initialisation and graph loading\n\taddWork(worklist, arrangement){\n\t\tif(!arrangement.work || !'@id' in arrangement.work) return workList;\n\t\tconst wID = arrangement.work['@id'];\n\t\tif(worklist.find(x => x['@id']===wID)){\n\t\t\treturn worklist;\n\t\t} else {\n\t\t\tlet wl2 = worklist.slice();\n\t\t\twl2.push(arrangement.work);\n\t\t\treturn wl2;\n\t\t}\n\t}\n\tgraphHasChanged(){\n\t\tlet arrangements = [];\n\t\tlet worklist = [];\n\t\t// 0. Get arrangements\n\t\tif(this.props.graph && this.props.graph.outcomes\n\t\t\t && this.props.graph.outcomes[0]\n\t\t\t && this.props.graph.outcomes[0]['@graph']\n\t\t\t && this.props.graph.outcomes[0]['@graph'].length){\n\t\t\tarrangements = this.props.graph.outcomes[0]['@graph'].map(this.transformArrangement);\n\t\t\t// Extract all unique works from the arrangements list\n\t\t\tworklist = arrangements.reduce(this.addWork, []);\n\t\t}\n\t\t// 1. convert this.graph.outcomes[0] into this.state.worklist\n    this.setState({arrangements: arrangements, worklist: worklist});\n\t}\n\n  graphComponentDidUpdate(props, prevProps, prevState) {\n\t\t// Boiler plate traversal code (should move to m-c-c)\n\t\t// Check whether the graph has updated and trigger further traversal as necessary.\n\t\t// Called by this.componentDidUpdate\n    var prevPool = prevProps.traversalPool;\n    var thisPool = props.traversalPool;\n    var updated  = false;\n    if (prevPool.running === 1 && thisPool.running ===0){\n      // check our traversal objectives if the graph has updated\n      props.checkTraversalObjectives(\n        props.graph.graph, props.graph.objectives);\n      updated = true;\n    } else if ( Object.keys(thisPool.pool).length && thisPool.running < MAX_TRAVERSERS) {\n      // Initiate next traverser in pool...\n      var uri = Object.keys(thisPool.pool)[0];\n      props.traverse(uri, thisPool.pool[uri]);\n      if (prevProps.graph.outcomesHash !== props.graph.outcomesHash) {\n        updated = true;\n      }\n    } else if ( props.traversalPool.running===0 ) {\n      if(prevProps.graph.outcomesHash !== props.graph.outcomesHash) {\n        updated = true;\n      }\n    }\n    return updated;\n  }\n\n\t// UI methods\n\n\tselectMeasures(){\n\t\tthis.setState({targetting: 'measure'});\n\t}\n\tselectNotes(){\n\t\tthis.setState({targetting: 'note'});\n\t}\n\n\tusefulIdForChildElement(element) {\n\t\tconsole.log(element);\n\t\tif(element.classList.contains(this.state.targetting)){\n\t\t\treturn element.id;\n\t\t} else if(this.state.targetting==='note' && element.classList.contains('chord')){\n\t\t\t// Ugly exception – chords have a stem that applies to all notes\n\t\t\treturn Array.from(element.getElementsByClassName('note')).map(x => x.id);\n\t\t} else if(!element.parentNode.parentNode) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn this.usefulIdForChildElement(element.parentNode);\n\t\t}\n\t}\n  handleNoteSelectionChange(key, selection) {\n\t\t// We need to replace this.state.selection[key] with the notes that contain newSelection\n\t\tconst selectionIds = selection.map(this.usefulIdForChildElement).flat();\n\t\tthis.handleSelectionChange(key, selectionIds);\n  }\n  handleMeasureSelectionChange(key, selection) {\n\t\t// We need to replace this.state.selection[key] with the notes that contain newSelection\n\t\tconst selectionIds = selection.map(x => x.id);\n\t\tthis.handleSelectionChange(key, selectionIds);\n  }\n\thandleSelectionChange(key, selectionIds){\n\t\tconst pane = document.getElementById(key);\n\t\tconst selectedElements = Array.from(pane.getElementsByClassName('selected'));\n\t\tconst newSelection = {...this.state.selection};\n\t\tselectedElements.forEach(thing => thing.classList.remove('selected'));\n\t\tselectionIds.forEach(e => document.getElementById(e).classList.add('selected'));\n\t\tnewSelection[key] = selectionIds;\n    this.setState({ selection: newSelection,\n\t\t\t\t\t\t\t\t\t\tmultiSelect: (Object.keys(newSelection).length > 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& Object.values(newSelection).filter(x => x.length).length > 1) });\n\t}\n\taddElementToSelectionObject(object, resourceURI, element) {\n\t\tif(!((pref.frbr+\"part\") in object)) object[pref.frbr+\"part\"] = [];\n\t\tobject[pref.frbr+\"part\"].push(resourceURI+\"#\"+element);\n\t\treturn object;\n\t}\n\tmakeSelectionJSONLDFromSelection(uri){\n\t\tconst selectionObject = {\"@type\": pref.bithTerms+\"Selection\"};\n\t\tthis.state.selection[uri].forEach(this.addElementToSelectionObject.bind(this, selectionObject, uri));\n\t\treturn selectionObject;\n\t}\n\tmakeExtractFromSelection(uri){\n\t\tconst extractObject = {\"@type\": pref.bithTerms+\"Extract\"};\n\t\textractObject[pref.frbr+\"member\"] = [this.makeSelectionJSONLDFromSelection(uri)];\n\t\treturn extractObject;\n\t}\n\tmakeMusicalMaterialFromSelection(){\n\t\tconst uris = Object.keys(this.state.selection);\n\t\tconst now = new Date();\n\t\tlet mm = {\"@type\": pref.bithTerms+\"MusicalMaterial\"};\n\t\tmm[pref.dct+\"created\"] = now.toISOString();\n\t\tmm[pref.frbr+\"embodiment\"] = uris.map(this.makeExtractFromSelection);\n\t\tthis.setState(update(this.state, {annotations: {$push: [mm]}}));\n\t}\n  handleScoreUpdate(scoreElement) {\n    console.log(\"Received updated score DOM element: \", scoreElement)\n  }\n\thandleChooseWork(work){\n\t\tthis.setState({mode: 'version', work: work });\n\t}\n\thandleChooseVersion(version){\n\t\tthis.setState({mode: 'score', versions: [version, false]});\n\t}\n\thandleReplaceVersion(version, replacePos){\n\t\t// Swap out one of the versions\n\t\tlet versions = this.state.versions.slice();\n\t\tversions[replacePos] = version;\n\t\tthis.setState({mode: 'compare', versions: versions});\n\t}\n\thandleAddVersionPane(){\n\t\tthis.setState({mode: 'addVersion'});\n\t}\n  handleSubmit(args) {\n    /* do any app-specific actions and return the object (e.g. a Web Annotation)\n     * to be submitted to the user POD */\n    console.log(\"Received args: \", args);\n    return {\n      \"@context\": \"http://www.w3.org/ns/anno.jsonld\",\n      \"target\": this.state.selection.map( (elem) => this.state.uri + \"#\" + elem.getAttribute(\"id\") ),\n      \"motivation\": \"highlighting\"\n    }\n  }\n\trender(){\n\t\tswitch(this.state.mode){\n\t\t\tcase 'version':\n\t\t\t\treturn this.renderVersions();\n\t\t\tcase 'addVersion':\n\t\t\t\treturn this.renderVersions();\n\t\t\tcase 'score':\n\t\t\t\treturn this.renderSingleScore();\n\t\t\tcase 'compare':\n\t\t\t\treturn this.renderTiledScores();\n\t\t\tcase 'work':\n\t\t\tdefault:\n\t\t\t\treturn this.renderWorks();\n\t\t}\n\t}\n\t// renderWorkInList(work){\n\t// \t// Each work is drawn separately to the works list\n\t// \treturn <div className=\"workListing\" onClick={ this.handleChooseWork.bind(this, work) }>{ work.title}</div> ;\n\t// }\n\n  renderWorkInList(work){\n      const handler = this.handleChooseWork.bind(this, work) ;\n      return <WorkListing key={work['@id']}\n\n                          shortTitle={work[pref.rdfs+\"label\"]}\n                          composer={work[pref.rdau+\"P60426\"][pref.rdfs+\"label\"]}\n                          opus={work[pref.gndo+\"opusNumericDesignationOfMusicalWork\"]}\n                          date={work[pref.gndo+\"dateOfPublication\"]}\n                          clickHandler={ handler } />;\n  }\n\n\trenderVersionInList(version){\n\t\t// Each verison is drawn separately to the versions list\n\t\tconst handler = this.state.mode===\"version\" ? this.handleChooseVersion.bind(this, version)\n\t\t\t\t\t: this.handleReplaceVersion.bind(this, version, 1)\n\t\treturn <VersionListing key={version.shortTitle}\n\t\t\t\t\t\t\t\t\t\t\t\t\t clickHandler={ handler } {...version}/>;\n\t}\n\trenderWorks(){\n\t\treturn (\n\t\t\t<div className=\"works\">\n\t\t\t\t{ this.state.worklist.map(this.renderWorkInList) }\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderWorkAsHeader(work){\n\t\tif(!work){\n\t\t\treturn <div/>;\n\t\t} else {\n\t\t\treturn <div/>;\n\t\t}\n\t}\n\trenderVersions(){\n\t\tif(!this.state.arrangements.length) return <div>Loading...</div>;\n\t\treturn (\n\t\t\t<div className=\"work\">\n\t\t\t\t<div className=\"workInfo\">{this.renderWorkAsHeader(this.work)}</div>\n\t\t\t\t<div className=\"versions\">\n\t\t\t\t\t{ this.work ?\n\t\t\t\t\t\tthis.state.arrangements.filter(x=> x.work===this.work).map(this.renderVersionInList) :\n\t\t\t\t\t\tthis.state.arrangements.map(this.renderVersionInList) }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\tselectionRadioButton(target, callback){\n\t\treturn <input type=\"radio\" name=\"target\" checked={this.state.targetting===target}\n\t\t\t\t\t\t\t\t\tclassName={this.state.targetting===target ? \"checked\" : \"unchecked\" }\n\t\t\t\t\t\t\t\t\tonChange={callback}\n\t\t\t\t\t\t\t\t\tvalue={target} id={target} /> ;\n\t}\n\tannotationButtons(){\n\t\tif(this.state.multiSelect){\n\t\t\treturn (\n\t\t\t\t<button className=\"musicalMaterial annotationButton\"\n\t\t\t\t\t\t onClick={ this.makeMusicalMaterialFromSelection } >\n\t\t\t\t\tParallel passages\n\t\t\t\t</button>\n\t\t\t);\n\t\t}\n\t}\n\trenderTiledScores(){\n\t\t// MEI URIs hardwired for testing\n\t\tif(!this.state.versions[0] && this.state.versions[1]) return <div>Loading...</div>;\n\t\tconst upperURI = this.state.arrangements.length ? this.state.arrangements[0].MEI : \"https://meld.linkedmusic.org/companion/mei/F1.mei\";\n//    const upperURI = \"https://raw.githubusercontent.com/DomesticBeethoven/data/main/op.%2092/ChorHallberger%20-%20D-BNba%20Nc%204_1846%20Schil/D-BNbaNc4_1846_Schil.mei>\";\n\t\tconst lowerURI = \"https://meld.linkedmusic.org/companion/mei/F2.mei\";\n\t\tconst upper = this.state.versions[0];\n\t\tconst lower = this.state.versions[1];\n\t\tconst selectionHandler = this.state.targetting==='note' ?\n\t\t\t\t\tthis.handleNoteSelectionChange :\n\t\t\t\t\tthis.handleMeasureSelectionChange ;\n\t\tconst narrowWindow = this.state.width < 800;\n\t\treturn(\n\t\t\t<main>\n\t\t\t\t<h4>Select:</h4>\n\t\t\t\t<div className=\"target switch-field\">\n\t\t\t\t\t{ this.selectionRadioButton('measure', this.selectMeasures) }\n\t\t\t\t\t<label htmlFor=\"measure\">Measures</label>\n\t\t\t\t\t{ this.selectionRadioButton('note', this.selectNotes) }\n\t\t\t\t\t<label htmlFor=\"note\">Notes</label>\n\t\t\t\t</div>\n\t\t\t\t{this.annotationButtons()}\n\t\t\t\t<VersionPane extraClasses=\"upper\"\n\t\t\t\t\t\t\t\t\t\t id=\"pane1\"\n\t\t\t\t\t\t\t\t\t\t narrowPane={ narrowWindow }\n\t\t\t\t\t\t\t\t\t\t width={ this.state.width }\n\t\t\t\t\t\t\t\t\t\t uri={ upper.MEI }\n\t\t\t\t\t\t\t\t\t\t //  shortTitle=\"Star Brightly Shining\"\n                     shortTitle={ upper.shortTitle}\n                     arranger=\"Josiah Pittman\"\n                     genre=\"Piano-vocal\"\n                     publisher=\"Augener & Co.\"\n                     date={ upper.date}\n                     place=\"London\"\n                     catNumber={ upper.catNumber}\n\t\t\t\t\t\t\t\t\t\t vrvOptions={ basicVrvOptions }\n\t\t\t\t\t\t\t\t\t\t selectionHandler={ selectionHandler.bind(this, upperURI) }\n\t\t\t\t\t\t\t\t\t\t selectorString={ selectorStrings[this.state.targetting] }\n\t\t\t\t\t\t\t\t\t\t handleScoreUpdate={ this.handleScoreUpdate } />\n\t\t\t\t<VersionPane extraClasses=\"lower\"\n\t\t\t\t\t\t\t\t\t\t width={ this.state.width }\n\t\t\t\t\t\t\t\t\t\t id=\"pane1\"\n                     shortTitle={lower.shortTitle}\n                     arranger=\"Friedrich Silcher\"\n                     genre=\"Choral music\"\n                     publisher=\"Hallberger\"\n                     date=\"1846\"\n                     place=\"Stuttgart\"\n                     catNumber={ lower.catNumber}\n\t\t\t\t\t\t\t\t\t\t uri={ lower.MEI }\n\t\t\t\t\t\t\t\t\t\t vrvOptions={ basicVrvOptions }\n\t\t\t\t\t\t\t\t\t\t selectionHandler={ selectionHandler.bind(this, lowerURI) }\n\t\t\t\t\t\t\t\t\t\t selectorString={ selectorStrings[this.state.targetting] }\n\t\t\t\t\t\t\t\t\t\t handleScoreUpdate={ this.handleScoreUpdate } />\n\t\t\t</main>\n\t\t);\n\t}\n  renderSingleScore() {\n    return(\n      <div>\n        <p>Current selection: { this.state.selection.length > 0\n          ? <span> { this.state.selection.map( (elem) => elem.getAttribute(\"id\") ).join(\", \") } </span>\n          : <span>Nothing selected</span>\n        }</p>\n\n        { /* pass anything as buttonContent that you'd like to function as a clickable next page button */ }\n        <NextPageButton\n          buttonContent = { <span>Next</span> }\n          uri = { this.state.uri }\n        />\n\n        { /* pass anything as buttonContent that you'd like to function as a clickable prev page button */ }\n        <PrevPageButton\n          buttonContent = { <span>Prev</span> }\n          uri = { this.state.uri }\n        />\n\t\t\t\t<button className=\"addPane\" onClick={this.handleAddVersionPane}>\n\t\t\t\t\t+\n\t\t\t\t</button>\n\n        <SelectableScore\n          uri={ this.state.versions[0].MEI }\n          options={ this.props.vrvOptions }\n          onSelectionChange={ this.handleSelectionChange }\n          selectorString = { selectorStrings[this.state.targetting] }\n          onScoreUpdate = { this.handleScoreUpdate }\n        />\n      </div>\n    )\n  }\n}\n\nfunction mapStateToProps({ graph , score, traversalPool}) {\n    return { graph , score, traversalPool };\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return bindActionCreators({ registerTraversal, traverse,\n                                setTraversalObjectives, checkTraversalObjectives, fetchGraph },\n                              dispatch);\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n"]},"metadata":{},"sourceType":"module"}