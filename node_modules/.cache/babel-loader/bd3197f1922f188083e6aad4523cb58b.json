{"ast":null,"code":"var _jsxFileName = \"/Users/mark/localRepos/StarBrightlyShining/src/containers/versionPane.js\";\nimport React, { Component } from 'react';\nimport SelectableScore from 'selectable-score/lib/selectable-score';\nimport SubmitButton from 'selectable-score/lib/submit-button.js';\nimport ExtractVisualiser from './extractVisualiser';\nimport { prefix as pref } from 'meld-clients-core/lib/library/prefixes'; //import { convertCoords } from 'meld-clients-core/lib/library/boxesForMeasures';\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction xmin(positions) {\n  return Math.min(...positions.map(pos => pos.x));\n}\n\nfunction xmax(positions) {\n  return Math.max(...positions.map(pos => pos.x2));\n}\n\nexport default class VersionPane extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showDetails: \"noDetails\",\n      lpos: 0\n    };\n    this.scrollPane = /*#__PURE__*/React.createRef();\n    this.toggleDetails = this.toggleDetails.bind(this);\n    this.scrollForward = this.scrollForward.bind(this);\n    this.scrollBackward = this.scrollBackward.bind(this);\n    this.xRanges = this.xRanges.bind(this);\n  }\n\n  xRanges(material) {\n    let xPositions = [];\n    const extracts = material[pref.frbr + \"embodiment\"];\n    const ids = extracts.reduce((extractNotes, extract) => {\n      return extract[pref.frbr + \"member\"].reduce((selectionNotes, selection) => {\n        return selection[pref.frbr + \"part\"].reduce((notes, uri) => uri.startsWith(this.props.uri + \"#\") ? notes.concat([uri]) : notes, selectionNotes);\n      }, extractNotes);\n    }, []);\n    const frags = ids.map(x => x.split('#')[1]);\n    const positions = frags.map(convertCoords);\n    return [xmin(positions), xmax(positions)];\n  }\n\n  toggleDetails() {\n    if (this.state.showDetails === \"metadata\") {\n      this.setState({\n        showDetails: \"noDetails\"\n      });\n    } else {\n      this.setState({\n        showDetails: \"metadata\"\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const margin = 30;\n\n    if (this.props.selectedAnnotation) {\n      console.log(this.props.selectedAnnotation, this.xRanges(this.props.selectedAnnotation), this.scrollPane.current);\n      this.scrollPane.current.scrollLeft = this.xRanges(this.props.selectedAnnotation)[0] - margin;\n    }\n  }\n\n  detailsButtonText() {\n    if (this.state.showDetails === \"metadata\") {\n      return \"Hide details\";\n    } else {\n      return \"Show details\";\n    }\n  }\n\n  scrollForward() {\n    const delta = this.state.showDetails === \"noDetails\" ? 0.90 * this.props.width : 0.75 * this.props.width;\n    this.scrollPane.current.scrollBy({\n      top: 0,\n      left: delta,\n      behavior: 'smooth'\n    });\n  }\n\n  scrollBackward() {\n    const delta = this.state.showDetails === \"noDetails\" ? 0.90 * this.props.width : 0.75 * this.props.width;\n    this.scrollPane.current.scrollBy({\n      top: 0,\n      left: -delta,\n      behavior: 'smooth'\n    });\n  }\n\n  vrvScale() {\n    const targetWidth = this.state.showDetails === \"noDetails\" ? Math.min(this.props.width, 1000) : Math.min(0.8 * this.props.width, 1000);\n    return Math.max(20, 45 - (1000 - targetWidth) / 20);\n  }\n\n  render() {\n    let vrvOptions = { ...this.props.vrvOptions,\n      adjustPageHeight: 0,\n      breaks: 'none',\n      pageWidth: 60000\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"music pane \" + this.props.extraClasses,\n      id: this.props.id,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main \" + this.state.showDetails,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"controllbar\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"leftControls\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"scoreScrollButton\",\n              onClick: this.scrollBackward,\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u21E6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 87,\n                columnNumber: 73\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 87,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"scoreScrollButton\",\n              onClick: this.scrollForward,\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u21E8\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 88,\n                columnNumber: 72\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 88,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"middle\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"rightControls\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"showDetails\",\n              onClick: this.toggleDetails,\n              children: this.detailsButtonText()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 92,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"scrollableScore\",\n          ref: this.scrollPane,\n          children: [/*#__PURE__*/_jsxDEV(SelectableScore, {\n            uri: this.props.uri,\n            vrvOptions: vrvOptions,\n            onSelectionChange: this.props.selectionHandler,\n            selectorString: this.props.selectorString,\n            onScoreUpdate: this.props.handleScoreUpdate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(ExtractVisualiser, {\n            uri: this.props.uri,\n            musicalMaterial: this.props.annotations,\n            toDraw: this.props.annotations.map(this.xRanges),\n            selectedAnnotation: this.props.selectedAnnotation,\n            handleSelectAnnotation: this.props.handleSelectAnnotation\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n        className: this.state.showDetails,\n        children: /*#__PURE__*/_jsxDEV(\"dl\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"Title:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: this.props.shortTitle\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"Genre:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 112,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: [\" \", this.props.genre]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 112,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"Arranger:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: this.props.arranger\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 30\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"Publisher:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: this.props.publisher\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 31\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"Date:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: this.props.date\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 26\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"Place:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 12\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: this.props.place\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 27\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"dt\", {\n              children: \"catNumber:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 18\n            }, this), /*#__PURE__*/_jsxDEV(\"dd\", {\n              children: this.props.catNumber\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 4\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/mark/localRepos/StarBrightlyShining/src/containers/versionPane.js"],"names":["React","Component","SelectableScore","SubmitButton","ExtractVisualiser","prefix","pref","xmin","positions","Math","min","map","pos","x","xmax","max","x2","VersionPane","constructor","props","state","showDetails","lpos","scrollPane","createRef","toggleDetails","bind","scrollForward","scrollBackward","xRanges","material","xPositions","extracts","frbr","ids","reduce","extractNotes","extract","selectionNotes","selection","notes","uri","startsWith","concat","frags","split","convertCoords","setState","componentDidUpdate","prevProps","prevState","margin","selectedAnnotation","console","log","current","scrollLeft","detailsButtonText","delta","width","scrollBy","top","left","behavior","vrvScale","targetWidth","render","vrvOptions","adjustPageHeight","breaks","pageWidth","extraClasses","id","selectionHandler","selectorString","handleScoreUpdate","annotations","handleSelectAnnotation","shortTitle","genre","arranger","publisher","date","place","catNumber"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport SelectableScore from 'selectable-score/lib/selectable-score';\nimport SubmitButton from 'selectable-score/lib/submit-button.js';\nimport ExtractVisualiser from './extractVisualiser';\nimport { prefix as pref } from 'meld-clients-core/lib/library/prefixes';\n//import { convertCoords } from 'meld-clients-core/lib/library/boxesForMeasures';\n\nfunction xmin(positions){\n\treturn Math.min(...positions.map(pos => pos.x));\n}\n\nfunction xmax(positions){\n\treturn Math.max(...positions.map(pos => pos.x2));\n}\n\nexport default class VersionPane extends Component {\n  constructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tshowDetails: \"noDetails\",\n\t\t\tlpos: 0\n\t\t}\n\t\tthis.scrollPane = React.createRef();\n\t\tthis.toggleDetails = this.toggleDetails.bind(this);\n\t\tthis.scrollForward = this.scrollForward.bind(this);\n\t\tthis.scrollBackward = this.scrollBackward.bind(this);\n\t\tthis.xRanges = this.xRanges.bind(this);\n\t}\n\txRanges(material) {\n\t\tlet xPositions = [];\n\t\tconst extracts = material[pref.frbr+\"embodiment\"];\n\t\tconst ids = extracts.reduce(\n\t\t\t(extractNotes, extract) => {\n\t\t\t\treturn extract[pref.frbr+\"member\"].reduce(\n\t\t\t\t\t(selectionNotes, selection) => {\n\t\t\t\t\t\treturn selection[pref.frbr+\"part\"].reduce(\n\t\t\t\t\t\t\t(notes, uri) => ((uri.startsWith(this.props.uri + \"#\")) ? notes.concat([uri]) : notes), selectionNotes);\n\t\t\t\t\t}, extractNotes);\n\t\t\t}, []);\n\t\tconst frags = ids.map(x => x.split('#')[1]);\n\t\tconst positions = frags.map(convertCoords);\n\t\treturn [xmin(positions), xmax(positions)];\n\t}\n\ttoggleDetails(){\n\t\tif(this.state.showDetails===\"metadata\"){\n\t\t\tthis.setState({showDetails: \"noDetails\"});\n\t\t} else {\n\t\t\tthis.setState({showDetails: \"metadata\"});\n\t\t}\n\t}\n\tcomponentDidUpdate(prevProps, prevState){\n\t\tconst margin = 30;\n\t\tif(this.props.selectedAnnotation){\n\t\t\tconsole.log(this.props.selectedAnnotation, this.xRanges(this.props.selectedAnnotation), this.scrollPane.current);\n\t\t\tthis.scrollPane.current.scrollLeft = this.xRanges(this.props.selectedAnnotation)[0] - margin;\n\t\t}\n\t}\n\tdetailsButtonText(){\n\t\tif(this.state.showDetails===\"metadata\"){\n\t\t\treturn \"Hide details\";\n\t\t} else {\n\t\t\treturn \"Show details\";\n\t\t}\n\t}\n\tscrollForward(){\n\t\tconst delta = this.state.showDetails===\"noDetails\" ? 0.90 * this.props.width : 0.75*this.props.width;\n\t\tthis.scrollPane.current.scrollBy({top: 0, left: delta, behavior: 'smooth'});\n\t}\n\tscrollBackward(){\n\t\tconst delta = this.state.showDetails===\"noDetails\" ? 0.90 * this.props.width : 0.75*this.props.width;\n\t\tthis.scrollPane.current.scrollBy({top: 0, left: - delta, behavior: 'smooth'});\n\t}\n\tvrvScale() {\n\t\tconst targetWidth = this.state.showDetails===\"noDetails\"\n\t\t\t? Math.min(this.props.width, 1000)\n\t\t\t: Math.min(0.8 * this.props.width, 1000);\n\t\treturn Math.max(20, 45 - ((1000-targetWidth) / 20));\n\t}\n\trender(){\n\t\tlet vrvOptions = {...this.props.vrvOptions, adjustPageHeight: 0, breaks: 'none',\n\t\t\t\t\t\t\t\t\t\t\tpageWidth: 60000};\n\t\treturn (\n\t\t\t<div className={\"music pane \"+this.props.extraClasses} id={this.props.id}>\n\t\t\t\t<div className={\"main \"+this.state.showDetails}>\n\t\t\t\t\t<div className=\"controllbar\">\n\t\t\t\t\t\t<div className=\"leftControls\">\n\t\t\t\t\t\t\t<div className=\"scoreScrollButton\" onClick={this.scrollBackward}><span>⇦</span></div>\n\t\t\t\t\t\t\t<div className=\"scoreScrollButton\" onClick={this.scrollForward}><span>⇨</span></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"middle\"/>\n\t\t\t\t\t\t<div className=\"rightControls\">\n\t\t\t\t\t\t\t<button className=\"showDetails\" onClick={this.toggleDetails}>\n\t\t\t\t\t\t\t\t{ this.detailsButtonText() }\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"scrollableScore\" ref={this.scrollPane}>\n\t\t\t\t\t\t<SelectableScore uri={this.props.uri}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t vrvOptions = { vrvOptions }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t onSelectionChange = { this.props.selectionHandler }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t selectorString = { this.props.selectorString }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t onScoreUpdate = { this.props.handleScoreUpdate } />\n\t\t\t\t\t\t<ExtractVisualiser uri={this.props.uri} musicalMaterial={this.props.annotations}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t toDraw={this.props.annotations.map(this.xRanges)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t selectedAnnotation={this.props.selectedAnnotation}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t handleSelectAnnotation={this.props.handleSelectAnnotation} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<aside className={this.state.showDetails}>\n\t\t\t\t\t<dl>\n\t\t\t\t\t\t<div><dt>Title:</dt><dd>{this.props.shortTitle}</dd></div>\n\t\t\t\t\t\t<div><dt>Genre:</dt><dd> {this.props.genre}</dd></div>\n\t\t\t\t\t\t<div><dt>Arranger:</dt><dd>{this.props.arranger}</dd></div>\n\t\t\t\t\t\t<div><dt>Publisher:</dt><dd>{this.props.publisher}</dd></div>\n\t\t\t\t\t\t<div><dt>Date:</dt><dd>{this.props.date}</dd></div>\n\t\t\t\t\t\t<div><dt>Place:</dt><dd>{this.props.place}</dd></div>\n            <div><dt>catNumber:</dt><dd>{this.props.catNumber}</dd></div>\n\t\t\t\t\t</dl>\n\t\t\t\t</aside>\n\t\t\t</div>\n\t\t);\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}